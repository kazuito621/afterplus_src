<div class='container' ng-controller="SitesCtrl">

	<button type="button"
		ng:cloak
		data-placement="center"
		ng-click="newSiteModalOpen()"
		class="btn btn-lg btn-primary pull-right topMargin5 bottomMargin5"
        style="max-width: 100%; width: auto;"
		data-animation="am-fade-and-scale" >New Property</button>

	<div class='table-responsive' ng-if="displayedSites.length > 0">
		<h1>Properties</h1>
		<table class='table table-striped'>
			<thead>
				<tr>
                    <th class="clickable-header" ng-click="sh.sortByColumn('siteID')">
                        ID <i ng-class="sh.columnClass('siteID')"></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('siteName')">
                        Name <i ng-class="sh.columnClass('siteName')"></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn(['city', 'state'])">
                        Location <i ng-class="sh.columnClass(['city', 'state'])"></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('treeCount')">
                        Trees <i ng-class="sh.columnClass('treeCount')"></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('reportCount')">
                        Est <i ng-class="sh.columnClass('reportCount')"></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('tstamp_lastContact')">
                        Activity <i ng-class="sh.columnClass('tstamp_lastContact')"></i>
                    </th>
					<th ng-if="auth.isAtleast('inventory')"></th>
				</tr>
			</thead>
            <tbody infinite-scroll="showMoreSites()" infinite-scroll-distance="3">
                <tr ng-repeat="s in displayedSites" ng-class="{active : isSelected(s.siteID)}" class='hoverHotspot'>
                    <td ng-bind="s.siteID"></td>
                    <td><a href ng-click='select(s.siteID)'>{{s.siteName}}</a></td>
                    <td>{{s.city}}, {{s.state}}</td>
                    <td>{{s.treeCount}}</td>
                    <td><a href='/#estimates?siteID={{s.siteID}}' bs-tooltip title='View estimates'>{{s.reportCount}}</a></td>
                    <td>{{s.tstamp_lastContact | formatDateFromNow}}</td>
                    <td>
                        <a ng-if="auth.isAtleast('inventory')" ng-click="existingSiteModalOpen(s.siteID)" 
								ng-class="(s.userCustCount<1 || s.userStaffCount<1) ? 'fa fa-frown-o _red _size6' : 'fa fa-pencil _grey _size6 hoverDisplay'" 
								bs-tooltip ng-attr-title="{{ (s.userCustCount<1 || s.userStaffCount<1) ? 'Property has no users assigned!' : 'Edit'}}" 
								style="text-decoration: none; cursor:pointer; cursor: hand;"></a> &nbsp;
                        <a ng-if="auth.isAtleast('inventory')" ng-click="queueOrDequeueItemForDelete(s.siteID, $event)" class="fa fa-times _red _size6 hoverDisplay" 
								bs-tooltip title="Delete" style="text-decoration: none; cursor:pointer; cursor: hand;"></a>
                    </td>
                </tr>
            </tbody>
		</table>
	</div>

</div>
