<div ng-controller="ReportCtrl as ReportCtrl" class='ReportCtrl div_{{routeParams.stateID}} padding-top-none'>

<!-- LOAD recent estimates list -->
<div ng-if="data.mode()=='trees' && !auth.is('customer')" style="margin-bottom: 15px;">
    <recent-estimates model="rdata.recentReportID" recent-report-list="recentReportList" get-recent-report-title="getRecentReportTitle(report)"></recent-estimates>
    <BR><BR>
    <button class="btn btn-blue clr-white" ng-cloak ng-click="newReport();">New Report</button>
</div>

<div class="touch-boundry">
	<div ng-include="'js/trees/action.tpl.html'" ng-if="data.mode()=='estimate' && auth.is('customer')"></div>
</div>	

<!--BEGIN ESTIMATE TABLE SECTION-->
<div bindonce="report" class="table_estimate estimate-container report_main mode_{{data.mode()}}" ng-if="report.siteID">
    <estimate-summary report="report" mode="data.mode()"></estimate-summary>

	<div class="estimate-actions" ng-if="data.mode()=='trees'">
		<button class="btn btn-red clr-white" ng-click="saveReport()">Save</button>
		<button class="btn btn-red clr-white" 
				data-backdrop='static'
				data-keyboard=true
				bs-modal
				data-template="js/trees/emailReport.tpl.html"
				ng-click="initEmailModal()"
				>Send</button>
		&nbsp;
        <span ng-if="report.reportID">
		<a ng-if='report.reportLink && report.reportID' href='/go/estimate/pdf/{{report.token}}' target='_cust_view'>PDF Version</a> &nbsp;|&nbsp;
		<a ng-if='report.reportLink && report.reportID' href='{{report.reportLink}}' target='_cust_view'
           onclick='return confirm("This will log you out. Continue?\n(Alternatively, you can copy and paste this into a completely different browser)");'>Customer View</a> &nbsp;|&nbsp;
        </span>
		<a ng-if='report.reportID && report.saveCount>1' href='/go/estimate/revisions/{{report.reportID}}' target=_new>Past Revisions</a>
			
		<div class="clearfix"></div>
	</div>	 

	<!-- Email logs -->
    <email-logs report="report"></email-logs>

   	<div class="table-container">
   		<div class="row row-table">
   			<div class="col-md-4" ng-if="data.mode()=='estimate'">
   				<div id="treeMap_estimate" class="map-container mode_{{data.mode()}}">
					<div id="treeMap2" class="mode_{{data.mode()}}"></div>
				</div>
   			</div>
   			<div class="col-md-8 col-info-{{data.mode()}}">
                <report-estimates-table></report-estimates-table>

				<div class="table-responsive">
				   	<table class="table ng-scope ng-table" ng-if="data.mode()=='trees' || report.services.length > 0 ">
				   		<thead>
							<tr>
								<td colspan="4">Misc. Services</td>
							</tr>
							<tr>
								<td colspan="{{ data.mode()=='trees' && '1' || '2' }}">Description</td>
								<td>Quantity</td>
								<td class="text-right">Price</td>
								<td ng-if="data.mode()=='trees'"></td>
							</tr>
						</thead>
   						
   						<tbody>
                        <tr ng-repeat="item in report.services" class="hoverHotspot">							   	<td data-title="service_desc" colspan="{{ data.mode()=='trees' && '1' || '2' }}">
									<a href editable-text='item.desc' ng-if='auth.isAtleast("inventory")'>{{item.desc}}</a>
									<span ng-if='!auth.isAtleast("inventory")'>{{item.desc}}</span>
								</td>
								<td data-title="service_quantity">
									<a href editable-text='item.quantity' ng-if='auth.isAtleast("inventory")'>{{item.quantity}}</a>
									<span ng-if='!auth.isAtleast("inventory")'>{{item.quantity}}</span>
								</td>
								<td data-title="service_price" class="text-right">
									<a href editable-text='item.price' ng-if='auth.isAtleast("inventory")'>{{item.price}}</a>
									<span ng-if='!auth.isAtleast("inventory")'>{{item.price}}</span>
								</td>
								<td ng-if="data.mode()=='trees'">
									<div ng-if="auth.isAtleast('inventory')">
										<a href ng-click="removeItem(item.$$hashKey,'services')"
											 class='fa fa-times _red _med hoverDisplay' ></a>
									</div>
								</td>
							</tr>

						   	<tr ng-if="data.mode()=='trees'">
								<td>
									<textarea ng-model="service.desc" class="rightMargin10" placeholder="Service Description" style='width:490px;height:2em;'></textarea>
								</td>
								<td>
									<span>
										x&nbsp;<input type="text" ng-model="service.quantity" class="rightMargin10" placeholder="1" style='width:30px;height:2em;' ng-init="service.quantity=1"></input>
									</span>
								</td>
								<td style="padding-left:0px;padding-right:0px"  class="text-right">
									<span>
										$&nbsp;<input type="text" ng-model="service.price"  placeholder="0.00" style='width:40px;height:2em;'></input>
									</span>
								</td>
								<td class="text-right">
						   			<button class="btn btn-red clr-white" ng-click="addMiscService(service.desc,service.quantity,service.price)">ADD</button>
						   		</td>
						   	</tr>

							<!-- // Subtotals // -->
							<tr ng-if="report.total.services">
								<td align=right colspan="3">Misc Services Subtotal:</td>
								<td class="text-right">&#36;{{report.total.services|formatPrice}}</td>
							</tr>
							<tr ng-if="report.total.services">
								<td align=right colspan="3">Tree Services Subtotal:</td>
								<td class="text-right">&#36;{{report.total.items|formatPrice}}</td>
							</tr>
						</tbody>	
   					</table>   					
				</div>

				<div class="total-amount">
					Total: &#36;{{(report.total.grand || 0)|formatPrice}}
				</div>

				<div class="section-container" ng-if="data.mode()=='trees' && auth.isAtleast('inventory')">
			   		<h6 class="section-sub-title">Notes</h6>
			        <textarea ckeditor="editorOptions" ng-model="report.notes" placeholder="Notes" style='width:100%;height:100px;'></textarea>
			     </div>
			     
			 	<div class="section-container" ng-if="data.mode()!='trees' || !auth.isAtleast('inventory')">
			 		<h6 ng-if="report.notes" class="section-sub-title" style='padding-bottom:1em;'>Notes</h6>
			        <span ng-bind-html="report.notes"></span><BR><BR>

			   		<h6 ng-if="treatmentDescriptions.length" class="section-sub-title">Definition of Treatments</h6>
					<div ng-repeat=" desc in treatmentDescriptions "> 
						<p><span style='font-weight:bold;'>{{desc.treatmentType}}</span> - {{desc.desc}}</p><BR>
					</div>
			   	</div>

			   	<div class="logo-container">
		   			<span class="logo"><img src="img/logo_wcisa.png"></span>
					<span class="logo"><img src="img/logo_ctsp.png"></span>
					<span class="logo"><img src="img/logo_papa.jpg"></span>
					<span class="logo"><img src="img/logo_treeworker.jpg"></span>
					<span class="logo"><img src="img/logo_bcma.jpg"></span>
			   	</div>
			   	
   			</div>
   		</div>
   	</div>

</div>

</div> <!-- }}} .report_main -->

<div style='margin:15px 0 60px 70px; font-size:130%; color:#555;' class="" ng-if="report.items.length<1">
    (No Trees Added to Estimate Yet)
</div>

<div class="clearfloat"></div>
