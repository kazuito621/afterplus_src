<div ng-include="'js/trees/action.tpl.html'" ng-if="auth.is('customer')"></div>
<div class='container' ng-controller="EstimatesListCtrl">    

	<div ng-if="auth.isAtleast('inventory')">
		<div class='pull-right topMargin5'>
			<div class="btn-group" bs-radio-group id="estimatesFilters" ng-model="status_filters_2">
				<label ng-click="setStatusFilter('all')"class="btn btn-default">
                    <input type="radio" value="all"> All</label>
				<label ng-click="setStatusFilter('sent')" class="btn btn-default">
                    <input type="radio" value="sent"> Sent</label>
				<label ng-click="setStatusFilter('approved')" class="btn btn-default">
                    <input type="radio" value="approved"> Approved</label>
				<label ng-click="setStatusFilter('completed')" class="btn btn-default">
                    <input type="radio" value="completed"> Completed</label>
                <span class="lnk leftSpace10">
                    <a href ng-click='reset()' bs-tooltip title='Reset'>
                        <b><i class="fa fa-rotate-left _red _size5 topMargin5 hoverHighlight"></i></b>
                    </a>
                </span>
            </div>
		</div>
		<br>
		<input type='text' ng-model='data.filterTextEntry' size=20 placeholder='Search'> 
		<a ng-if="data.filterTextEntry.length" ng-click="data.filterTextEntry=''" class='fa fa-times _red _size5 hand'></a>
		<span class='gray' ng-if='data.getSiteCount()'> &nbsp; {{data.getSiteCount()}} properties being displayed.</span>
	</div>
	<BR><BR>

    <div class='table-responsive' ng-if="displayedEstimates.length > 0">
        <table class='table table-striped' id='estimatesList'>
            <thead>
                <tr>
                    <th class="td-check clickable-header text-center" ng-if="auth.isAtleast('inventory')">
                        <input type="checkbox" ng-checked="checkedEstimates.selectAll" ng-click="toggleAllEstimatesSelection()">
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('reportID')">
                        ID <i ng-class="sh.columnClass('name')" class='silver'></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('name')">
                        Estimate Name <i ng-class="sh.columnClass('name')" class='silver'></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('siteName')">
                        Site Name <i ng-class="sh.columnClass('siteName')" class='silver'></i>
                    </th>
                    <th ng-if="auth.isAtleast('inventory')" class="clickable-header" ng-click="sh.sortByColumn('sales_email')">
                        Sales Rep <i ng-class="sh.columnClass('sales_email')" class='silver'></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('total_price')">
                        Total <i ng-class="sh.columnClass('total_price')" class='silver'></i>
                    </th>
                    <th class="clickable-header" ng-click="sh.sortByColumn('status')">
                        Status <i ng-class="sh.columnClass('status')" class='silver'></i>
                    </th>
                    <th ng-if="auth.isAtleast('inventory')" class="clickable-header" ng-click="sortDateCol()">
                        {{getDateColHeader()}} <i ng-class="getDateColClass()" class='silver'></i>
                    </th>
                    <th style="min-width: 75px;"></th>
                </tr>
            </thead>


            <tbody infinite-scroll="showMoreEstimates()" infinite-scroll-distance="3">
                <tr ng-repeat="e in displayedEstimates" class='hoverHotspot' id='item_{{e.reportID}}'>
                    <td class="td-check text-center" ng-if="auth.isAtleast('inventory')">
                        <input type="checkbox" ng-checked="isEstimateSelected(e.reportID)" ng-click="toggleEstimateSelection(e.reportID)">
                    </td>
                    <td ng-bind="e.reportID"></td>
                    <td>
						<span ng-if="auth.isAtleast('inventory')">
							<a href="#/trees?reportID={{e.reportID}}" ng-bind="e.name_short" bs-tooltip title="{{e.name}}"></a>&nbsp;
							<a ng-if="e.saveCount>1" href='/go/estimate/revisions/{{e.reportID}}' bs-tooltip title='{{e.saveCount}} revisions'><i class='fa fa-clock-o gray'></i></a>
						</span>
						<a ng-if="!auth.isAtleast('inventory')" href="#/estimate/{{e.hashLink}}" ng-bind="e.name_short" bs-tooltip title="{{e.name}}"></a>
					</td>
                    <td>
						<span title="{{e.siteName}}">{{e.siteName_short}}</span> &nbsp; 
						<i site-edit-modal clients="initData.clients" site-id="e.siteID" 
                           class="fa fa-pencil _grey _size4 hoverDisplay" title="Edit" bs-tooltip style="cursor: pointer;"></i>
					</td>
                    <td ng-if="auth.isAtleast('inventory')">
                        <a href e-ng-options="obj.id as obj.email for obj in salesUsers"
                           onshow="getSalesUsers()"
                           editable-select="e.sales_userID"
                           onaftersave="updateEstimate(e)">
                            {{e.sales_email_short}}
                        </a>
                    </td>
                    <td>${{e.total_price|formatPrice}}</td>
                    <td>
						<button ng-if="auth.isAtleast('inventory')" class="btn btn-default" ng-class="'clr-'+e.status" 
								ng-model="e.status" ng-change="setReportStatus(e,this)"
								placeholder="{{e.status}}"
								ng-options="s.id as s.txt for s in data.statuses(e.status)"
								bs-select onclick="return false;">
						</button> 
						<!--<a href='#/estimate/{{e.hashLink}}' ng-if="!auth.isAtleast('inventory')" ng-bind='e.status' ng-class='"small-tag "+e.status'-->
							
					</td>
                    <td ng-if="auth.isAtleast('inventory')">{{getTstamp(e) | formatDate}}</td>
                    <td>
                        <a ng-if="auth.isAtleast('inventory')"
                           delete-with-confirm-button
                           type="estimate"
                           item-id="{{e.reportID}}"
                           active-popover="activePopover"
                           on-confirm-callback="deleteCurrentItem()"
                           class="fa fa-times _red _size7 hand hoverDisplay"
                           bs-tooltip title="Delete"
                           style="text-decoration: none;"></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="action-float-bar" ng-show="checkedEstimates.ids.length > 0">
        <div class="container">
            <div class="action-float-bar-inner">
                <i class='fa fa-mail-forward fa-rotate-270 white'></i> &nbsp;
                <a href="#" ng:cloak ng-click="duplicate($event)" style="margin-left: 50px;">
                    Duplicate
                </a>
            </div>
        </div>
    </div>
</div>
