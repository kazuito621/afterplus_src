<main ng-controller="TreesCtrl as TreesCtrl">

<div ng-include="'js/trees/action.tpl.html'" ng-if="data.mode()=='trees' && auth.is('customer')"></div>

<div class="trees-container" ng-show="data.mode()=='trees'">
	<div class="trees-container-inner">
		<div class="row row-nopad">
			<div class="col-sm-3 col">
				<div class="filters-container">
					<section ng-if="data.mode()=='trees'"> 

						<div class="filter-container-title" ng:cloak ng-show="TFSdata.selectedFilters.length>0">
							<span ng-if="!TFSdata.containsContradictingFilters">{{TFSdata.selectedFilters.length}}&nbsp;</span>Filters Active &nbsp; <span class="lnk-clear"><a href ng-click='clearFilters();'>
                                <i class="fa fa-times"></i></a></span>
						</div>

						<div class="row row-xss">
							<div class="col-xs-6 col">

								<div class='filter-container' ng-if="auth.is('customer') && initData.sites.length>1"> 
									<div class="row row-xs row-nopad">
										<div class="col-xs-5 col">
											<div class="filter-header">
												<h3>Property</h3>
											</div>	
										</div>
										<div class="col-xs-7 col">
											<div class="filter-input">
												<select  id="select_site" class='inpt inpt-select' ng-disabled="filteredSites.length === 0" 
													ng-model="selected.siteID"
													ng-change="onSelectSiteID(selected.siteID)">
													<option bindonce class="option" ng-repeat="site in filteredSites" value="{{site.siteID}}" bo-bind="site.siteName"></option>
												</select>
											</div>	
										</div>
									</div>
								</div>	

								<!--FILTER SECTION: SPECIES-->
								<div class="filter-container">
							    	<div class="filterHeader filter-header">
							      		<h3>Species <span class='filterTypeCount' ng-if="TFSdata.filterTypeCounts.species>0">({{TFSdata.filterTypeCounts.species}})</span></h3>
							    	</div>
								    <div class="filter-input">
								      	<input ng-model='filterSearch.species' type="text" class="styled_input inpt inpt-text" placeholder="Search Species"/>
										<span class="inpt-clear" ng-if="filterSearch.species.length>0"><a href ng-click="filterSearch.species=''"><i class="fa fa-times"></i></a></span>
								    </div>
								    <div class="filterBlock filter-block">
								    	<div class="filter-items">
								     		<div class="filterItems filter-item" 
											ng-repeat="speciesType in initData.filters.species | filterByString:'commonName':filterSearch.species " 
											ng-if="speciesType.count!=0 || speciesType.count>0">
												<!-- NOTE: there are 2 ways in which a filter can be hidden...
														1. if the user is searching for one.. and it doesnt match (filterByString)
														2. if the tree results list doesnt include any of this particular species 
																(TreeFilterService will then modify the .hide property
												-->
												<label>
													<input type="checkbox" id="checkBox_filter_species_{{speciesType.speciesID}}" value="{{speciesType.speciesID}}"  
													ng-model="speciesType.selected"
													ng-change="onFilterChange('species', speciesType.speciesID, speciesType.selected)">
													<span class="text">{{speciesType.commonName}} <span class='filterCount' ng-if="speciesType.count>0">({{speciesType.count}})</span></span>
													<div class="clearfix"></div>
												</label>
											</div> <!-- }}} .filterItems -->
										</div>	
								    </div>
								</div> 
							    <!-- END SPECIES FILTER SECTION --> 
							</div>
							<div class="col-xs-6 col">

							    <!--FILTER SECTION: TREATMENT TYPE-->
							    <div class="filter-container">
									<div class="filterHeader filter-header">
										<h3>Treatments: <span class='filterTypeCount' ng-if="TFSdata.filterTypeCounts.treatments>0">({{TFSdata.filterTypeCounts.treatments}})</span></h3>
									</div>
									<div class="filter-input">
										<input ng-model='filterSearch.treatments' type="text" class="styled_input inpt inpt-text" placeholder="Search Treatments" ng-escape="filterSearch.treatments=''"/>
										<span class="inpt-clear" ng-if="filterSearch.treatments.length>0"><a href ng-click="filterSearch.treatments=''"><i class="fa fa-times"></i></a></span>
									</div>
									<div class="filterBlock filter-block">
										<div class="filter-items">
											<div class="filterItems filter-item" 
											ng-repeat="t in initData.filters.treatments | filterByString:'treatmentType':filterSearch.treatments" 
											ng-if="t.count!=0 || t.count>0">
		        								<label>
		        									<input type="checkbox" id="checkBox_filter_treatment_{{t.treatmentTypeID}}" value="{{t.treatmentTypeID}}"
		        									ng-model="t.selected"
		        									ng-change="onFilterChange('treatments', t.treatmentTypeID, t.selected)">
													<span class="text">{{t.treatmentType}} <span class='filterCount' ng-if="t.count>0">({{t.count}})</span></span>
													<div class="clearfix"></div>
												</label>
		    								</div>
		    							</div>	
		    						</div>
		    					</div>		
								<!-- END TREATMENT TYPE FILTER SECTION --> 
							</div>
						</div> 	

						<div class="collapse-container">
							<div class="collapse-head">
								<a href="#">Filters <i class="fa fa-angle-double-down"></i></a>
							</div>
							<div class="collapse-preview">
								<!-- START YEAR FILTER SECTION --> 
								<div class="filter-container">
									<div class="filterHeader filter-header">
										<h3>By Year: &nbsp; 
													<button class="btn btn-default" ng-model="filters.year" placeholder="All Years"
															ng-disabled="!filters.years.length"
															ng-change="onSelectYear(filters.year)"
															ng-options="y.id as y.desc for y in filters.years"
															bs-select onclick="return false;">
														Action <span class="caret"></span>
													</button> 
													<a ng:cloak ng-show="filters.year" href ng-click="onSelectYear(false)" class='fa fa-times _red _size4' ></a>

										</h3>
									</div>
								</div>
							    <!-- END YEAR FILTER SECTION -->
							</div>

							<div class="collapse-body">

								<div class="row row-xss">
									<div class="col-xs-6 col">
										<!--FILTER SECTION: Building, Hardscape and Powerline -->
									    <div class="filter-container">
									    	<div class="filterHeader filter-header">
												<h3>Hazards:</h3>
											</div>
											<div class="filterBlock filter-block">
												<div class="filter-items filter-items-inline filter-items-toggle">
													<div class='filterItems filter-item' ng-show="TFSdata.filterTypeCounts.building>0">
														<label class="toggle-label">
															<input type="checkbox"  value="yes" test="building"
															ng-model="initData.filters.hazards.building.selected"
															ng-change="onFilterChange('building', '', initData.filters.hazards.building.selected)" class="toggle-check">
															<span class="text btn btn-gray btn-xs" ng-class="{'active' : initData.filters.hazards.building.selected}">
																<i class='fa fa-building _red'></i> Building
																<span class='filterTypeCount' ng-if="TFSdata.filterTypeCounts.building>0">({{TFSdata.filterTypeCounts.building}})</span>
															</span>	
															<div class="clearfix"></div>
														</label>
													</div>
													<div class='filterItems filter-item' ng-show="TFSdata.filterTypeCounts.caDamagePotential>0">
														<label class="toggle-label">
															<input type="checkbox"  value="potential"  
															ng-model="initData.filters.hazards.caDamagePotential.selected"
															ng-change="onFilterChange('caDamagePotential', '', initData.filters.hazards.caDamagePotential.selected)" class="toggle-check">
															<span class="text btn btn-gray btn-xs" ng-class="{'active' : initData.filters.hazards.caDamagePotential.selected}">
																<i class='fa fa-warning _orange'></i> Hardscape Damage Potential
																<span class='filterTypeCount' ng-show="TFSdata.filterTypeCounts.caDamagePotential>0">({{TFSdata.filterTypeCounts.caDamagePotential}})</span>
															</span>
															<div class="clearfix"></div>
														</label>
													</div>
													<div class='filterItems filter-item' ng-show="TFSdata.filterTypeCounts.caDamage>0">
														<label class="toggle-label">
															<input type="checkbox"  value="yes" 
															ng-model="initData.filters.hazards.caDamage.selected"
															ng-change="onFilterChange('caDamage', '', initData.filters.hazards.caDamage.selected)" class="toggle-check">
															<span class="text btn btn-gray btn-xs" ng-class="{'active' : initData.filters.hazards.caDamage.selected}">
																<i class='fa fa-warning _red'></i> Hardscape Damage
																<span class='filterTypeCount' ng-if="TFSdata.filterTypeCounts.caDamage>0">({{TFSdata.filterTypeCounts.caDamage}})</span>
															</span>	
															<div class="clearfix"></div>
														</label>
													</div>
													<div class='filterItems filter-item' ng-show="TFSdata.filterTypeCounts.powerline>0">
														<label class="toggle-label">
															<input type="checkbox"  value="yes" 
															ng-model="initData.filters.hazards.powerline.selected"
															ng-change="onFilterChange('powerline', '', initData.filters.hazards.powerline.selected)" class="toggle-check">
															<span class="text btn btn-gray btn-xs" ng-class="{'active' : initData.filters.hazards.powerline.selected}">
																<i class='fa fa-bolt _red'></i> Powerline
																<span class='filterTypeCount' ng-if="TFSdata.filterTypeCounts.powerline>0">({{TFSdata.filterTypeCounts.powerline}})</span>
															</span>	
															<div class="clearfix"></div>
														</label>
													</div>
												</div>
											</div>
											
										</div>	

										<!-- END Building, Hardscape, POWERLINE FILTER SECTION -->

										<!--FILTER SECTION: SIZE-->
										<div class="filter-container">
											<div class="filterHeader filter-header">
												<h3>Size <span class='filterTypeCount' ng-show="TFSdata.filterTypeCounts.treatments>0">({{TFSdata.filterTypeCounts.treatments}})</span></h3>
											</div>
											<div class="filterBlock filter-block">
												<div class="filter-items filter-items-inline filter-items-toggle">
													<div class="filter-item" ng-repeat="(idx,size) in initData.filters.dbh" ng-if="size.count!=0 || size.count>0">
														<label class="toggle-label">
                                                            <input type="checkbox" id="checkBox_filter_size_{{size.dbhID}}" value="{{size.dbhID}}"
															ng-model="size.selected"
															ng-change="onFilterChange('dbh', size.dbhID, size.selected)" class="toggle-check">
															<span class="text btn btn-gray btn-xs" ng-class="{'active' : size.selected}">{{size.diameter}}
                                                                <span class='filterCount' ng-if="size.count>0">({{size.count}})</span></span>
															<div class="clearfix"></div>
														</label>
														<div ng-if=" $index>0 && $index % 2 == 0" style='clear:both'></div>
													</div> <!-- }}} ng-repeat -->
												</div>	
											</div>
										</div>	
				    					<!-- END SIZE FILTER SECTION --> 
				     
									</div>
										
									<div class="col-xs-6 col">

										<!--FILTER SECTION: HEALTH-->   
										<div class="filter-container">
											<div class="filterHeader filter-header">
												<h3>Health <span class='filterTypeCount' ng-show="TFSdata.filterTypeCounts.rating>0">({{TFSdata.filterTypeCounts.rating}})</span></h3>
											</div>
											<div class="filterBlock filter-block">
												<div class="filter-items filter-items-inline filter-items-toggle">
													<div class="filterItems filter-item" ng-repeat="r in initData.filters.ratings" ng-if="r.count!=0 || r.count>0">
														<label class="toggle-label">
                                                            <input type="checkbox" id="checkBox_filter_rating_{{r.ratingID}}" value="{{r.ratingID}}"
															ng-model="r.selected" 
															ng-change="onFilterChange('rating', r.ratingID, r.selected)" class="toggle-check">
															<span class="text btn btn-gray btn-xs" ng-class="{'active' : r.selected}"
                                                                  bs-tooltip title="{{r.ratingID}} - {{r.rating_desc}}">&nbsp;{{r.ratingID}}  <span class='filterCount' ng-if="r.count>0">({{r.count}})</span>&nbsp;</span>
															<div class="clearfix"></div>
														</label>
													</div> <!-- }}} ng-repeat -->
												</div>
											</div>	
										</div>
										<!-- END HEALTH FILTER SECTION -->

				    				</div>
								</div>
									
								
							</div>
						</div>

					</section>    	
				</div>	
			</div>	
			<div class="col-sm-9 col">				
				<div class="row row-nopad">
					
					<div class="col-sm-8 col">
						<div class="content-container">

							<div class="admin-filter-container" ng-if="data.mode()=='trees' && auth.isAtleast('inventory')" >
								<nav>
									<div class="row">
										<div class="col-sm-10">
											<div class="row">
												<div class="col-sm-4">
													<div class="input-group">
														<select id="select_clientType" class='inpt inpt-select'
														ng-model="selected.clientTypeID" 
														ng-change="onSelectClientTypeID(selected.clientTypeID)"
														ng-disabled="initData.clientTypes.length === 0">
															<option class="option" value="">Client Type</option>
                                                            <option bindonce class="option" ng-repeat="clientType in initData.clientTypes" value="{{clientType.clientTypeID}}" bo-bind="clientType.name"></option>
													  	</select>
													</div>
												</div>
												<div class="col-sm-4">
													<div class='input-group'>
													 	<select  id="select_client" class='inpt inpt-select' ng-disabled="clients.length === 0"  
															ng-model="selected.clientID"
															ng-change="onSelectClientID(selected.clientID)" title="TEST">
													    	<option class="option" value="">Client</option>
													    	<option bindonce class="option" ng-repeat="client in filteredClients" value="{{client.clientID}}" bo-bind="client.clientName"></option>
													  	</select>
													</div>
												</div>
												<div class="col-sm-4">
													<div class='input-group'>
													  	<select  id="select_site" class='inpt inpt-select' ng-disabled="filteredSites.length === 0" 
															ng-model="selected.siteID"
															ng-change="onSelectSiteID(selected.siteID)">
													    	<option class="option" value="">{{ filteredSites.length>0 | ifElse:'Property':'(No Properties)' }}</option>
													    	<option bindonce class="option" ng-repeat="site in filteredSites" value="{{site.siteID}}" bo-bind="site.siteName"></option>
													  	</select>
													</div>
												</div>	
											</div>	
										</div>
										<div class="col-sm-2" ng-if="auth.isAtleast('inventory')" style='margin-left:0; padding-left:0;'>
											<span ng-if="selected.siteID>0" style='color:#667; font-size:.85em;'>#{{selected.siteID}}</span> 
											</span>
											<span class="lnk" ng-if="selected.siteID>0">
													<i site-edit-modal clients="initData.clients" site-id="selected.siteID" 
														class="fa fa-pencil _grey _size8 hoverHighlight hand"></i>
											</span>
											<span class="lnk">
												<a href ng-click='reset()' bs-tooltip title='Reset'><i class="fa fa-rotate-left _red _size6 hoverHighlight"></i></a> 
											</span>
										</div>
									</div>
									
								</nav>
							</div>

							<!-- begin center content area -->
							<section class="map-container mainContent top-margin-none {{'mode_'+data.mode()}}" ng-class="{{'mode_'+data.mode()}}">
								<div id='treeDetails' ng:cloak ng-show="data.showTreeDetails && data.mode()=='trees'" ng-include="'js/trees/edit.tpl.html'"></div>
                                <div id="searchPanel" class="mtop3" style="display:none;">
                                    <a id="zoomToMappedTrees" class="fa fa-tree _red _size7 search-panel-button mright3"
                                       ng-click="zoomToMappedTrees()" ng-if="googleMapSearchBoxValue && googleMapSearchBoxValue!=''" 
									   bs-tooltip title='Jump back to trees'></a>
                                    <input id="googleSearchbox" class="controls" type="text" placeholder="Find Address"
                                           ng-model="googleMapSearchBoxValue">
                                    <a id="searchButtonForSearchBox" class="fa fa-map-marker _red _size7 search-panel-button mleft3"
                                       ng-show="googleMapSearchBoxValue && googleMapSearchBoxValue!=''"
                                       ng-click="zoomToSearchMarker()"></a>
                                    <a id="clearButtonForSearchBox" class="fa fa-times _red _size7 search-panel-button mleft3"
                                          ng-show="googleMapSearchBoxValue && googleMapSearchBoxValue!=''"
                                            ng-click="cleanSearchMarkers();"></a>
                                </div>
								<div ng:cloak ng-show="data.showMap && data.mode()=='trees'" id="treeMap" ng-class="{{data.mode()}}" class="map"></div>
							</section>	<!-- }}} mainContent -->
						</div>	
					</div>

					<div class="col-sm-4 col">
						<div class="result-container">
							<section class="nav_listings" ng-if="data.mode()=='trees'"> 

								<div class="table-responsive">
									<table class="tree-list-container" ng-if="auth.isAtleast('inventory')">
										<thead>
											<tr>
												<td>
													<div class="btn-group">
														<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
															<i class="fa fa-check-square-o"></i>
															<span class="caret"></span>
														</button>
														<ul class="dropdown-menu" role="menu">
															<li><a href ng-click="toggleCheckedTrees(true)">ALL</a></li>
															<li><a href ng-click="toggleCheckedTrees('thisYear')">ALL {{thisYear}}</a></li>
															<li><a href ng-click="toggleCheckedTrees(false)">NONE</a></li>
														</ul>
													</div>
												</td>
												<td colspan="3"><h6>{{selectedTrees.length}} of {{TFSdata.treeResultsCount}} trees selected </h6></td>
											</tr>
										</thead>
									</table>
									<div class="tree-list-outer" id="tree-list-container">
										<table class="tree-list-container">
											<tbody>
												<tr bindonce ng-repeat="tree in trees" ng-if="tree.hide != true" id="tree-result-item-row-{{tree.treeID}}" 
														ng-mouseover="onTreeResultMouseOver(tree)" ng-mouseleave="onTreeResultMouseLeave(tree)">
													<td class="td-check">													
														<input type="checkbox" checklist-model="selectedTrees" checklist-value="tree.treeID" 
															id="tree-result-checkbox-{{tree.treeID}}">
													</td>
													<td class="td-img">
                                                        <label for="tree-result-checkbox-{{tree.treeID}}">
                                                            <div tooltip-html-unsafe="{{listingPopoverContent}}" popover-trigger="mouseenter">
                                                                <img bo-src="tree.imgSm" data-treeID='{{tree.treeID}}'
                                                                     ng-click="onTreeImageRollover(tree.treeID);" ng-mouseover="onTreeImageRollover(tree.treeID);" ng-mouseleave="onTreeImageRollout(tree.treeID);"
                                                                     data-imgMed="{{tree.imgMed}}"
                                                                     style="border:2px solid #{{colors.bg[tree.colorID]}}"/>
                                                            </div>
                                                        </label>
													</td>
													<td>
                                                        <label for="tree-result-checkbox-{{tree.treeID}}">
                                                            <h6>{{tree.commonName}}</h6>
                                                            <p>{{tree.dbhID|dbhID2Name:this}}</p>
                                                            <small><span class='recYear {{tree.history|showRecoYear:"css"}}' ng-bind-html="tree.history|showRecoYear"></span>
                                                                <span bo-text="'(ID:' + tree.treeID + ')'"></span></small>
                                                        </label>
													</td>
													<td class="td-action" style="padding: 0px;">
                                                        <label for="tree-result-checkbox-{{tree.treeID}}">
                                                            <a href='#/tree_edit/{{tree.treeID}}' bs-tooltip title="View/Edit Details" style="padding: 5px;"><i class="fa fa-pencil"></i></a>
                                                        </label>
													</td>
												</tr>
											</tbody>
											
										</table>
									</div>	
									<table class="tree-list-container" ng-if="auth.isAtleast('inventory') && trees.length">
										<thead>
											<tr>
												<td>
													<div class="btn-group">
														<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
															<i class="fa fa-check-square-o"></i>
															<span class="caret"></span>
														</button>
														<ul class="dropdown-menu" role="menu">
															<li><a href ng-click="toggleCheckedTrees(true)">ALL</a></li>
															<li><a href ng-click="toggleCheckedTrees('thisYear')">ALL {{thisYear}}</a></li>
															<li><a href ng-click="toggleCheckedTrees(false)">NONE</a></li>
														</ul>
													</div>
												</td>
												<td colspan="3"><h6>{{selectedTrees.length}} of {{TFSdata.treeResultsCount}} trees selected</h6></td>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<td colspan="4">
													<button class="btn btn-block btn-red clr-white txt-bold" ng-click="addToEstimate()">Add to Estimate</button>
												</td>
											</tr>
                                            <tr>
                                                <td colspan="4">
													<button class="btn btn-default" ng-model="data.overrideTreatmentCodes" multiple max-length=0 all-none-buttons=1
															ng-options="t.code as t.treatmentType for t in initData.filters.treatments" 
															bs-select placeholder="Override Recommended Treatment" onclick="return false;">
														Treatments <span class="caret"></span>
													</button>
													<a ng-if="data.overrideTreatmentCodes.length" class='fa fa-times _red _size8 hand' style='padding-left:.2em;'
															ng-click='data.overrideTreatmentCodes=[]'></a>
                                                </td>
                                            </tr>
										</tfoot>
									</table>
								</div>	
								
								<!--
							  	<div>
							     	<div class="nav_listings_header pullright centerText width192">Search Results: {{TFSdata.treeResultsCount}} Trees located </div>
							     	<div class="clearfloat"></div>
							    </div>
								-->
							  	<!--BEGIN LISTING OPTIONS SECTION-->
							  	<!--
							   	<div class="pullleft centerText width192 topSpace10">
							        Select:{{ alert(1) }}
									
								</div>
								-->
							    
							    <!--  	 
								<div class="pullleft topSpace10 width192 centerText">
							    	<p>{{selectedTrees.length}} of {{trees.length}} trees selected</p>
							    </div>
								--> 
								<!-- ADD TO ESTIMATE button/selectors -->
								<!--
								<div class="pullleft width192 topSpace5 space5">
										<button class="navButton width180 roundedCorners" ng-click="addToEstimate()">Add to Estimate</button>
									<div style='padding-top:1em; font-size:11pt;'>
									<label><input type=checkbox ng-model='data.showTreatmentList'> Show Treatments</label>
									</div>
								</div>
								<div class="pullleft width180 space5" ng-cloak ng-show="data.showTreatmentList">
									<select class="multiList" size="10" multiple ng-model="selected.treatmentCodes">
										<option ng-repeat="treatment in initData.filters.treatments" value="{{treatment.code}}">{{treatment.treatmentType}}</option>
									</select>
								</div> <!-- ng-cloak -->
								
							</section>	<!-- }}} listing options and left hand column-->
						</div>	
					</div>

				</div>

			</div>
		</div>
	</div>
</div>

<div class="clearfix"></div>
<div ng-include="'js/trees/report.tpl.html'"></div>

</main>
